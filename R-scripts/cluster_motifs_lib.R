###################################################################
## Library with R functions required in R-scripts/cluster_motifs.R

################################################################
## Check parameter values
check.param <- function() {
  ## Check that input file has been specified
  if (!exists("infile")) {
    stop("Missing mandatory argument: infile=[matrix_comparison_table] ")
  }
  verbose(paste("Input file", infile), 1)

  ## Check that description file
  if (!exists("description.file")) {
    stop("Missing mandatory argument: description.file=[matrix_description_table] ")
  }
  verbose(paste("Description file", description.file), 1)

  ## Check that output file has been specified
  if (!exists("out.prefix")) {
    stop("Missing mandatory argument: out.prefix=[output_prefix] ")
  }
  verbose(paste("Output prefix", out.prefix), 1)

  ## Check that distance table file has been specified
  if (!exists("distance.table")) {
    distance.table <<- paste(sep="", out.prefix, "_dist_table.tab")
  }
  verbose(paste("Distance table", distance.table), 1)

  ## Default score is the normalized correlation
  if (!exists("score")) {
    score <<- "Ncor";
  }

  ## Default hclust method is the complete method
  if (!exists("hclust.method")) {
    hclust.method <<- "average";
  }

  ## Define the kind of metric used: scores or distances
  supported.scores <- c("cor", "Ncor")
  supported.distances <- c(NULL)

  if(score %in% supported.scores){
    metric <<- "similarity"

    ## Default lower and upper thresholds equals to zero
    if (!exists("lth")) {
      lth <<- list()
      lth[["Ncor"]] <<- 0;
      lth[["cor"]] <<- 0;
      lth[["w"]] <<- 0;

      lth.values <<- unlist(lth)
      lth.scores <<- names(lth.values)
    }
    if (!exists("uth")) {
      uth <<- list()
      uth[["Ncor"]] <<- 1;
      uth[["cor"]] <<- 1;

      uth.values <<- unlist(uth)
      uth.scores <<- names(uth.values)
    }

  } else if(score %in% supported.distances){
    metric <<- "distances"

  }


  #####################
  ##
  if(exists("lthsp")){
    lthsp <- unlist(strsplit(lthsp, "_"))
    lth.scores <<- lthsp[seq(1,length(lthsp), by = 2)]
    lth.values <<- as.numeric(lthsp[seq(2,length(lthsp), by = 2)])

    for(i in 1:length(lth.scores)){
      thresholds[[lth.scores[i]]] <<- lth.values[i]
    }

    supported <- c("cor", "Ncor", "w")
    if(length(setdiff(supported, lth.scores)) > 0){
      for(add in setdiff(supported, lth.scores)){
        lth.scores <<- append(lth.scores, add)
        lth.values <<- append(lth.values, 0)
      }
    }
  }

  ## Set the labels
  labels <<- unique(labels)
}


#####################################################
## Creates the folders where the branch-motifs
## for each merge level of the tree will be stored
create.dir.merge <- function(level){

  ## Create the folder with the merged consensuses
  merge.dir <- paste("merged_consensuses/", level, sep = "")
  dir.create(file.path(cluster.folder, merge.dir), showWarnings = FALSE, recursive = TRUE)
  new.dir <- file.path(cluster.folder, merge.dir)

  flag <- system(paste("ls ", new.dir, "/ | wc -l", sep = ""), intern = TRUE)
  if(flag >= 1){
    system(paste("rm -r ", new.dir, "/*", sep = ""))
  }
}
