<html>
  <head>
    <title>ECCB 2014 tutorial T01 - Using RSAT with a Docker Virtual Environment (VE)</title>
    <link rel="stylesheet" type="text/css" href = "../../../course.css" media="screen">

    <script type="text/javascript" src="../syntaxhighlight/shCore.js"></script>
    <script type="text/javascript" src="../syntaxhighlight/shBrushBash.js"></script>
    <script type="text/javascript" src="../syntaxhighlight/shBrushR.js"></script>
    <link type="text/css" rel="stylesheet" href="../syntaxhighlight/shCore.css"/>
    <link type="text/css" rel="stylesheet" href="../syntaxhighlight/shThemeDefault.css"/>
    <script type="text/javascript">
      SyntaxHighlighter.config.clipboardSwf = 'syntaxhighlight/clipboard.swf';
      SyntaxHighlighter.all();
      
    </script>
    
    
	<script language="JavaScript" type="application/javascript">
	  <!--
	      function sizeTbl2(h,i) {
	      var tbl = document.getElementById(i);
	      tbl.style.display = h;
	      }
	      // -->
	</script> 
	
  </head>
  <body class="info">

    <h1>ECCB 2014 tutorial T01 - Using RSAT with a Docker Virtual Environment (VE)</h1>

    
    <p class="author">Jacques van Helden and C&eacute;line Hernandez</p>
    
    <a name='contents'></a>
    <h2>Contents</h2>
    <ul>
      <li><a href="#intro">Introduction</a></li>
      <li><a href="#prerequisite">Prerequisite</a></li>
      <li><a href="#quick_tour">Quick tour</a></li>
    </ul>

    <hr><a name="intro"></a>
    <a href="#contents"><font size=-2>[back to contents]</font></a>
    <h2>Introduction</h2>
    
    <hr><a name="prerequisite"></a>
    <a href="#contents"><font size=-2>[back to contents]</font></a>
    <h2>Prerequisite</h2>

    <p>Before running this tutorial, you need to install Docker on
      your computer (<a target='_blank'
      href='https://docs.docker.com/installation/'>https://docs.docker.com/installation/</a>).
    </p>
    
    <hr><a name="quick_tour"></a>
    <a href="#contents"><font size=-2>[back to contents]</font></a>
    <h2>Quick tour</h2>

    <h3>Specific step for Mac OSX users</h3>

    <div class="protocol">

      <p>To run docker under Mac OSX, you must first run the
      program <span class="program">boot2docker</span>.</p>

      <ol>

	<h4>Starting docker on Mac OSX</h4>

	<li><p>
	  <pre class="brush:bash;">boot2docker start</pre>

	  <p class="attention">Important: when starting, boot2docker will
	    display an message indicating the local IP of your docker
	    host. 
	  </p>
	
<pre class="terminal">
2014/08/12 09:43:36 Waiting for VM to be started...
.......
2014/08/12 09:43:58 Started.
2014/08/12 09:43:58   Trying to get IP one more time
2014/08/12 09:43:58 To connect the Docker client to the Docker daemon, please set:
2014/08/12 09:43:58     export DOCKER_HOST=tcp://192.168.59.103:2375</pre>

	</p></li>

	<li><p>Before running docker, you must export the corresponding
	    environment variable. Type the following command in the
	    terminal (replace [...] by the actual address reported by
	    boot2docker).
	    <pre class="brush:bash">export DOCKER_HOST=tcp://192.168.59.103:2375</pre>
	    </p>

	    <p class="tips"><b>Tip:</b>You can always obtain the IP
	    address of your boot2docker host with the following command:
	      <pre class="brush:bash">boot2docker ip</pre>
	    </p>

	    <p>Connect to the shared folder using Finder (OS X).
	      <br>Connect to cifs://192.168.59.103/data
	      <bR>Once mounted, will appear as /Volumes/data
	    </p>

	</li>

	<h4>Folder sharing</h4>
	
	<li>In order to use the "build" function in docker, you also
	  need to perform one step: ensuring the fodler sharing
	  (see <a target='_blank'
		  href='https://github.com/boot2docker/boot2docker#folder-sharing'>
	    https://github.com/boot2docker/boot2docker#folder-sharing</a></li>
	<pre class="brush:bash">
# Make a volume container (only need to do this once)
docker run -v /data --name my-data busybox true

# Share it using Samba (Windows file sharing)
docker run --rm -v /usr/local/bin/docker:/docker -v /var/run/docker.sock:/docker.sock svendowideit/samba my-data

# then find out the IP address of your Boot2Docker host
boot2docker ip
## Should return something like this:    192.168.59.103
	</pre>

      </ol>
    </div>


    <p>More information about boot2docker is available on the Docker
      Web site <a target=='_blank'
    href='https://docs.docker.com/installation/mac/'>https://docs.docker.com/installation/mac/</a>.</p>

    <h3>Hello docker</h3>

    <div class="protocol">
      <ol>
	<li><p><b>Check that docker is installed</b> on your machine
	  <pre class="brush:bash;">docker version</pre>
	</p></li>

	<li><p><b>Get the list of docker commands</b>
	  <pre class="brush:bash;">docker</pre>
	</p></li>

	<li><p><b>Docker's "Hello world" test</b>
	    <br>Test the following command to check that docker is
	    working fine.
	    <pre class="brush:bash;">docker run hello-world</pre>
	</p></li>

	<li><p><b>Running a command in an Ubuntu 12.04 shell</b>

	  <br>The following command will download (if required) an
	  image of Ubuntu 12.04, and run a simple command in it.
	    <pre class="brush:bash;">docker run ubuntu:12.04 echo "Hello world"</pre>
	  </p>

	  <p class="comment">The first time you run ubuntu:12.04,
	    docker will download the image (this can take a few
	    minutes, depending on the speed of your Internet
	    connection). The next calls tu ubuntu:12.04 will
	    immediately launch the local image, and you will be able
	    to instantly execute any command under Ubuntu 12.04, as
	    you will notice by typing the command again.</p>

	    <pre class="brush:bash;">docker run ubuntu:12.04 echo "Hello world again"</pre>
	</li>

	<div class="comment">
	  <p>Docker allows you to run alternative distributions of
	    Linux (for example Ubuntu, Centos, ...), or alternative
	    versions of a given distribution (for example Ubuntu 14.04
	    and 12.04). This is particularly convenient for checking
	    software portability. </p>
	  
	  
	  <p>In the previous example, we choose Ubuntu 12.04 because it
	    occupies less space (108Mb) than the current Ubuntu
	    release (14.04 in August 2014). If you dispose of a fast
	    connection and are not too limited in hard drive space,
	    you can re-run the command above replacing ubuntu:12.04 by
	    ubuntu:14.04. This will require to tranfer 225.4Mb from
	    the docker image repository, and to occupy the same space
	    on your hard drive. </p>
	  </div>
	<li><p><b>Getting the list of docker images</b>
	    <br>To obtain a list of all the docker images running on
	    your machine, type
	    <pre class="brush:bash">docker images</pre>

	    <pre class="terminal">
REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
ubuntu              14.04               c4ff7513909d        34 hours ago        225.4 MB
ubuntu              12.04               822a01ae9a15        34 hours ago        108.1 MB
hello-world         latest              565a9d68a73f        4 weeks ago         922 B
</pre>

	</li>
	
	<li><p><b>Removing docker images</b>
	  <br>Docker images and containers occupy a relatively
	    important space on your hard drive, so after having played
	    around with docker, you will probably like to remove
	    images you don't intend to use anymore.
	  </p>


	  <p>However, docker will not allow you to remove an image as
	    long as there are still some containers depending on it
	    (for the difference betwen image and container,
	    see <a target="_blank"
	    href="http://stackoverflow.com/questions/21498832/in-docker-whats-the-difference-between-a-container-and-an-image">here</a>). We
	    will thus proceed in the following order: 
	    <ol type="a">
	      <li>List the containers depending on the image we want to suppress (for example hello-world)
		<pre class="brush:bash">docker ps -as</pre>
	      </li>

	      <li>Identify those depending on the image to be suppressed
		<pre class="brush:bash">docker ps -as | grep hello-world</pre>
	      </li>
	      
	      <li>Remove these containers
		<pre class="brush:bash">docker rm  $(docker ps -as | grep hello | awk '{print $1}')</pre>
	      </li>

	      <li>Identify the image we want to delete
		<pre class="brush:bash">docker images | grep hello-world</pre>
	      </li>

	      <li>Remove this image
		<pre class="brush:bash">docker images | grep hello-world | awk '{print $3}' | xargs docker rmi</pre>
	      </li>
	    </ol>
	  </p>


	  <p class='exo'>Exercise: apply the same protocol to delete
	    the ubuntu:14.04 image (assuming you did run it, and you
	    don't need it anymore).</p>


	</li>
	
      </ol>
    </div>

    
    
    <hr>
  </body>
</html>

