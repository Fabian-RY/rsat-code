<!-- Load c3.css -->
<link href="--c3_css--" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="--datatable_css--"/>

<!-- Load d3.js and c3.js -->
<script type="text/javascript" src="--d3--" charset="utf-8"></script>
<script type="text/javascript" src="--c3--"></script>
<script type="text/javascript" src="--jquery--"></script> 
<script type="text/javascript" src="--datatable--"></script>

<head>
  --he--
  --show_command--
</head>

<style>
--lines_w--

        #Profile_header{
	   margin: 7px 5px 7px 0px;
	   width: 1280px;
	   height: 275px;
	   text-align: left;
	   color: black;
	   font-size: 16px;
	   border-radius:5px;
           background: #B1D4F9;
	   position: relative;
	   display: block;
	   clear : both;
	   float: left;
        }

  .tab{
    font-size: 10px;
    text-align: center;
    text-decoration: none;
    display: block;
    background-color: #E6E6E6;
    clear: both;
    float: left;
    position: relative;
    border-radius:5px;
    border-top: 0px;
    padding: 15px 15px 3px 15px;
  }

  .tab_col {
    padding: 7px 30px 7px 30px;
    background-color: #B1D4F9 !important;
    text-align: center;
  }

  .small_logo {
	position: relative;
	max-width: 100%;
	max-height: 10%;
	height: 45px;
	width: 35px
	float: left;
	clear: both;
  }
  
    .small_pic {
	position: relative;
	max-width: 100%;
	max-height: 25%;
	height: 115px;
	width: 100px
	float: left;
	clear: both;
  }

  .plot_tab {
	position: relative;
	height: 125px;
	width: 100px
	float: left;
	clear: both;
  }

  .logo_tab {
	position: relative;
	height: 45px;
	width: 55px
	float: left;
	clear: both;
  }

  td {
    text-align: center;
  }

  .c3 svg g g.c3-axis.c3-axis-x {
    font: 12px sans-serif;
  }

  .c3 svg g g.c3-axis.c3-axis-y {
    font: 12px sans-serif;
  }

  .div_chart {
	position: relative;
        display: block;
	float: left;
	clear: both;
  //      margin-top:10px;
  }

  .div_chart_sp {
	      position: relative;
        display: block;
	      float: left;
	      clear: both;
        margin-top:10px;
        margin-bottom:10px;
  }

  .spacer {
        margin-top:10px;
        margin-bottom:10px;
  }

  .button_chart {
	position: relative;
        cursor:pointer;
	      float: left;
        margin-top:10px;
        margin-left:3px;
        background-color: #D6EEFA;
        color: #0D73A7;
        border-radius:5px;
        font-size: 15px;
        text-align: center;
  }

 .tooltip_tab{ 
   width: auto;
    height: 30px;
    font-size: 20px;
    margin-top: 3px;
    text-align: center;
    text-decoration: none;
    background-color: #B1D4F9;
    border-radius:5px;
  }
  
   .tooltip_cell{
   width:auto;
       height: 30px;
    font-size: 20px;
    margin-top: 3px;
    text-align: center;
    text-decoration: none;
    background-color: #E6E6E6;
    border-radius:5px;
  }

        #header{
	   margin: 7px 5px 5px 5px;
	   width: 1250px;
	   height: 215px;
	   position: relative;
	   display: block;
	   text-align: left;
	   clear : both;
	   color: black;
	   font-size: 12px;
	   border-radius:5px;
           background: #B1D4F9;
	   float: left;
        }

      /* disable text selection */
      svg *::selection {
         background : transparent;
      }

      svg *::-moz-selection {
         background:transparent;
      }

      svg *::-webkit-selection {
         background:transparent;
      }
      rect.selection {
        stroke          : #333;
        stroke-dasharray: 4px;
        stroke-opacity  : 0.5;
        fill            : transparent;
      }

      rect.cell-border {
        stroke: #eee;
        stroke-width:0.3px;
      }

      rect.cell-selected {
        stroke: rgb(51,102,153);
        stroke-width:0.5px;
      }

      rect.cell-hover {
        stroke: #F00;
        stroke-width:0.3px;
      }

      text.mono {
        font-size: 12pt;
        font-family: Consolas, courier;
        fill: #686666;
      }

      text.text-selected {
        fill: #000;
      }

      text.text-highlight {
        fill: #c00;
      }
      text.text-hover {
        fill: #00C;
      }
      
      #tooltip {
        z-index: 1;
        position: absolute;
        width: auto;
        height: auto;
        padding: 10px;
        background-color: white;
        -webkit-border-radius: 10px;
        -moz-border-radius: 10px;
        border-radius: 10px;
        -webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
        -moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
        box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
        pointer-events: none;
      }

      #tooltip.hidden {
        display: none;
      }

      #tooltip p {
        margin: 0;
        font-family: sans-serif;
        font-size: 20px;
        line-height: 20px;
      }
      
 .small_logo_tooltip {
	position: relative;
	height: 85px;
	width: 100px
	float: left;
	clear: both;
  }
  
   .small_profile_tooltip {
	position: relative;
	height: 150px;
	width: 150px
	float: left;
	clear: both;
  }


 #show_all_button {
        background-color: #C1FFC7;
 }

 #hide_all_button {
        background-color: #FCACAC;
 }
 
  #show_all_button_cov {
        background-color: #C1FFC7;
 }

 #hide_all_button_cov {
        background-color: #FCACAC;
 }

  .button_click:active {
        position:relative;
        top:1px;
  }

  .Section_button {
  background-color: #D6EEFA;
  float: left;
  margin-top: 2px;
  margin-bottom: 2px;
  width: 450px;
  height: 20px;
  position: relative;
  display: block;
  text-align: center;
  color: #0D73A7;
  font-size: 15px;
  padding: 4px;
  clear: both;
  border-radius:5px;
  cursor: pointer;
  }

  .selected_header_section {
    color : #CC6600;
    background-color: #F6E6CA !important;
    border: 1px solid #F6E6CA;
  }

  #heatmap_png {
	heigth: 650px;
	width: 550px;
  }
  
  #heatmap_coocurrence_png {
	heigth: 650px;
	width: 550px;
  }

 .file_link {
  cursor: pointer;
  text-decoration: none;
  }

  .file_link:hover {
  text-decoration: underline;
  }

.c3-legend-item {
  font-size: 10px;
  }
  
}

</style>

<div id="summary_table_button" class="button_click Section_button selected_header_section"><strong>Parameters Table</strong></div>
<div id="summary_table" class="tab spacer">
<!-- <h2 style="margin-top: 0px;margin-bottom: 3px;">Results Summary</h2> -->
<table style="width:1270px" id="head_table" >
<thead><tr>
	  <th class="tab_col">Bin size</th>
	  <th class="tab_col">Nb of Bins</th>
	  <th class="tab_col">Nb of sequences</th>
	  <th class="tab_col">Nb of motifs</th>
	  <th class="tab_col">P-val (motif matches)</th>
</tr></thead>
<tbody>
          <td class="par_text">--bin_l-- nt </td>
          <td class="par_text">--bin_nb--</td>
          <td class="par_text">--seq_nb--</td>
          <td class="par_text">--motif_nb--</td>
          <td class="par_text">--p--</td>
</tbody>
</table></div>


<div id="dynamic_profile_button" class="button_click Section_button"><strong>Profiles</strong></div>
<div id="dynamic_profile" style="display:none" class="div_chart">
<div id="Profile_header"> 
   <div><h2 style="text-align:center">Scanning profile</h2></div> 
   <ul> 
      <li type="square">The plot shows the binding profile (the counts of number of matches per bin) of each input PSSM through the input sequences.</li>
      <li type="square">The P-values are calculated using Chi-square test of goodnes of fit, where the Null hypothesis assumes a homogeneous distribution of matches along the sequences.</li> 
      <li type="square">The motifs names are orderer according their significance.</li> 
   </ul> 
   <p>
      <ul> <h3>Dynamic Features</h3> 
         <li type="square">Click on each PSSM name (right side) to display/hide each profile individually.</li> 
         <li type="square">Pointing to each profile displays its <b>Motif name</b>, <b>Motif ID</b>, <b>P-value</b>, <b>Significance</b> and <b>Motif Logo</b>.</li> 
         <li type="square">Click on the buttons to Show/Hide all the profiles.</li> 
         <li type="square">You can filter the displayed profile in basis of their <b>Significance</b> by typing a number in the threshold button.</li> 
      </ul> 
   </p>  

</div> 
<div  style="display:block; clear:both;position:relative;float:left;">
      <button class='small button_chart' id='show_all_button' onclick='show_all();'>Show All Profiles</button>
      <button class='small button_chart' id='hide_all_button' onclick='hide_all();'>Hide All Profiles</button>
--button_clusters--
<button class='small button_chart' onclick='sig_upper_threshold();'><b>Significance</b>: Lower threshold<div><input style="height:20px;margin:5px;" type="number" value='' id="sig_up" /></div></button>
<button class='small button_chart' onclick='search_motifs();'><b>Search:</b><div><input style="height:20px;margin:5px;" type="search" value='' id="search_motifs" /></div></button>
<!-- <button class='small button_chart' onclick='sig_lower_threshold();'>Hide TEST<div id="ccc"><input type="number" id="sig_low" /></div></button> -->

   </div>
   <div id="chart" class="div_chart_sp"></div>
</div>


<div id="individual_motif_button" class="button_click Section_button"><strong>Individual Motif View</strong></div>
--tab--


<!--New section-->
<div id="sig_coverture_button" class="button_click Section_button"><strong>Significance vs Fraction of covered sequences</strong></div>
<div id="sig_coverture" style="display:none" class="div_chart">
 
<div  style="display:block; clear:both;position:relative;float:left;">
      <button class='small button_chart' id='show_all_button_cov' onclick='show_all_cover();'>Show All Points</button>
      <button class='small button_chart' id='hide_all_button_cov' onclick='hide_all_cover();'>Hide All Points</button>
      --cluster_points--
      
<button class='small button_chart' onclick='sig_upper_threshold();'><b>Significance</b>: Lower threshold<div><input style="height:20px;margin:5px;" type="number" value='' id="sig_up" /></div></button>
<button class='small button_chart' onclick='search_motifs();'><b>Search:</b><div><input style="height:20px;margin:5px;" type="search" value='' id="search_motifs" /></div></button>

   </div>
   <div id="coverchart" class="div_chart_sp"></div>
</div>


<div id="heatmap_button" class="button_click Section_button" ><strong>Profiles Heatmap</strong></div>
<div id="heatmap" style="display:none" class="div_chart_sp tab" style="width:1200px;padding:0px 0px 20px 0px;margin-top:0px;display:none;">

  <h2 style="margin:0px">Heatmap View</h2>
  <p> <a target="_blank" href="--heatmap_pdf--">PDF</a></p>
  <a target="_blank" href="--heatmap_pdf--"><img id="heatmap_png" src="--heatmap_png--"></a>
</div>


<div id="heatmap_coocurrence_button" class="button_click Section_button" ><strong>Co-ocurrence Heatmap</strong></div>
<div id="heatmap_coocurrence" style="display:none" class="div_chart_sp tab" style="width:1200px;padding:0px 0px 20px 0px;margin-top:0px;display:none;">
  
  
  <h2 style="margin:0px"><a target="_blank" href="--heatmap_coocurrence_pdf--">Co-ocurrence Heatmap (PDF)</a></h2>

<div style="display:block; clear:both;position:relative;float:left;">

Order:
  <select id="order">
    <option value="default">default</option>
    <option value="average">average linkage</option>
    <option value="complete">complete linkage</option>
    <option value="single">single linkage</option>
    <option value="ward">ward linkage</option>
  </select>
</div>
<div id="tooltip" class="hidden"><p><span id="value"></p></div>

<div id="d3_heatmap_coocurrence" style='overflow:auto; width:auto; height:auto;display:block; clear:both;position:relative;float:left;'></div>
  
</div>

<div id="additional_files_button" class="button_click Section_button" ><strong>Additional Files</strong></div>
<div id="additional_files" class="tab spacer" style="display:none;">
<table style="width:1270px" id="head_table" >
<thead><tr>
	  <th class="tab_col">File</th>
	  <th class="tab_col">Description</th>
</tr></thead>
<tbody>
   <tr><td class="par_text" style="text-align:left"><a target="_blank" class="file_link" href="--full_motif_table--">Motif table (Full)</a></td><td class="par_text" style="text-align:left">A table with additional information of each motif (i.e. the chi-squared value, degrees of freedom, etc ).</td></tr>
   <tr><td class="par_text" style="text-align:left"><a target="_blank" class="file_link" href="--hit_counts_table--">Hit counts per bin</a></td><td class="par_text" style="text-align:left">A table with the total number of hits of each motif for each bin.</td></tr>
   <tr><td class="par_text" style="text-align:left"><a target="_blank" class="file_link" href="--density_table--">Hit density per bin</a></td><td class="par_text" style="text-align:left">A table with the density of hits of each motif for each bin.</td></tr>
</tbody>
</table></div>


<script>

var chart = c3.generate({
   bindto: '#chart',
    data: {
        columns: [
          --x_y--
        ],
            type: 'line',
        names: {
          --names--
        },
    },

    subchart: {
        show: false
    },

    zoom: {
        enabled: false
    },


    size: {
        height: --chart_h--,
        width: 1275
    },

    grid: {
        x: {
            show: false
        },
        y: {
            show: true
        }
    },

    legend: {
        position: 'bottom'
    },

    padding: {
        top: 0,
        right: 100,
        bottom: 15,
        left: 100,
    },

    tooltip: {
        grouped: false, // Default true
        contents: tooltip_contents,
    },

    color: {
        pattern: [--color_pattern--]
    },

    point: {
        show: false
    },

    axis: {
        y: {
            max: --y_axis--,
            min: 0,
            label : {
                    text: 'Fraction of TFBSs',
                    position: 'outer-middle',
            },

        },

        x: {
            label: {
                    text: 'Distance (bp)',
                    position: 'outer-center',
            },
            tick: {
                    culling: false
            },
            type: 'category',
            categories: [--categories--]
        },
    },

});

    var profile_clusters = new Array();
--profile_clusters_array--

    var TF_coverture = new Array();
--TF_covertures--

    var TF_names = new Array();
--TF_names--

    var pvalues = new Array();
--pvalues--

    var qvalues = new Array();
--qvalues--

    var pics = new Array();
--pics--

    var pics_rc = new Array();
--pics_rc--

    var IDs = new Array();
--IDs--

    var significances = new Array();
--significances--

function show_all() {
    chart.show([--all--]);
}

function hide_all() {
    chart.hide([--all--]);
}

// Show each cluster separately
--function_profile_clusters--

Array.prototype.difference = function (x) {
    return this.filter(function (i) {
        return !(x.indexOf(i) > -1);
    });
};


function sig_upper_threshold(){

var x = document.getElementById('sig_up').value ||  --sig_min--;

 var index = [--all--];
 var newIndex = new Array();
 
 c = 0;
 for(i = 0; i < index.length; i++){
 
     if(significances[index[i]] < x){
  	
  	newIndex[c] = index[i];
        c++;
     }   
  }


//a.difference(b);

var diff = index.difference(newIndex);
chart.show(diff);
chart.hide(newIndex);
}


function sig_lower_threshold(){

 var x = document.getElementById('sig_low').value

 var index = [--all--];
 var newIndex = new Array();
 
 c = 0;
 for(i = 0; i < index.length; i++){
 
     if(significances[index[i]] <= x){
  	
  	newIndex[c] = index[i];
        c++;
     }   
  }
chart.hide(newIndex);
}


function search_motifs(){

   var x = document.getElementById('search_motifs').value;
   var index = [--tfs--];
   var newIndex = new Array();
   var newIDmotif = new Array();
   c = 0;

//document.write('<br>' + x + '<br>'); 

   for(i = 0; i < index.length; i++){

     tf = index[i];

     newIDmotif[c] = TF_names[tf];

     if(tf == x){  	
  	newIndex[c] = TF_names[x];
        c++;
     }
   }

//   var diff = newIDmotif.difference(newIndex);
//   chart.hide(newIDmotif);
   
   hide_all();
   chart.show(newIndex);
   
}

function tooltip_contents(d, defaultTitleFormat, defaultValueFormat, color) {
    var $$ = this, config = $$.config, CLASS = $$.CLASS,
        titleFormat = config.tooltip_format_title || defaultTitleFormat,
        nameFormat = config.tooltip_format_name || function (name) { return name; },
        valueFormat = config.tooltip_format_value || defaultValueFormat,
        text, i, title_name, title_ID, title_p, title_pc, title_q, title_s, title_c, value, name, bgcolor;

    // You can access all of data like this:
    console.log($$.data.targets);
    
    for (i = 0; i < d.length; i++) {
        if (! (d[i] && (d[i].value || d[i].value === 0))) { continue; }
        
        if (! text) {
            title_name = 'Motif Name';
	    title_ID = 'Motif ID';
            title_p = 'P-val';
            title_q = 'Q-val';
            title_s = 'Sig';
            title_c = 'Fraction of sequences';
            title_pc = 'Profile cluster';
            title_logo = 'Logo';
            title_logo_rc = 'Logo RC';
            text = "<table class='" + CLASS.tooltip + "'>" + "<tr><th colspan='1'>" + title_name + "</th><th colspan='1'>" + title_ID + "</th><th colspan='1'>" + title_p + "</th><th colspan='1'>" + title_q + "</th><th colspan='1'>" + title_s + "</th><th colspan='1'>" + title_c + "</th><th colspan='1'>"+ title_pc +"</th><th colspan='1'>" + title_logo + "</th><th colspan='1'>" + title_logo_rc + "</th></tr>";
        }

        name = nameFormat(d[i].name);
        value = valueFormat(d[i].value, d[i].ratio, d[i].id, d[i].index);
        bgcolor = $$.levelColor ? $$.levelColor(d[i].value) : color(d[i].id);

        text += "<tr class='" + CLASS.tooltipName + "-" + d[i].id + "'>";
        text += "<td class='name'><span style='background-color:" + bgcolor + "'></span>" + name + "</td>";
        text += "<td>" + IDs[d[i].id] + "</td>";
        text += "<td>" + pvalues[d[i].id] + "</td>";
        text += "<td>" + qvalues[d[i].id] + "</td>";
        text += "<td>" + significances[d[i].id] + "</td>";
        text += "<td>" + TF_coverture[d[i].id] + "</td>";
        text += "<td>" + profile_clusters[d[i].id] + "</td>";
        text += "<td><img class='small_logo' src='" + pics[d[i].id] + "' /></td>";
        text += "<td><img class='small_logo' src='" + pics_rc[d[i].id] + "' /></td>";
        text += "</tr>";
    }
    return text + "</table>";   
}


</script>


<script>

var coverchart = c3.generate({
    bindto: '#coverchart',
    data: {
                xs: {
          --xs_coverture--
        },
        columns: [
          --x_y_coverture--
        ],

        type: 'scatter',
        names: {
          --names_cov--
        },
    },
    
    point: {
        r: 6
    },

    subchart: {
        show: false,
    },

    zoom: {
        enabled: false,
    },


    size: {
        height: --chart_h--,
        width: 1275
    },

    grid: {
        x: {
            show: true
        },
        y: {
            show: true
        }
    },

    legend: {
        position: 'bottom'
    },

    padding: {
        top: 0,
        right: 100,
        bottom: 15,
        left: 100,
    },
    
    tooltip: {
        grouped: false, // Default true
        contents: tooltip_contents_2,
    },
    
    color: {
        pattern: [--color_pattern--]
    },
    
    axis: {
        y: {
            padding: {top:5, bottom:0},
            max: 100,
            min: 0,
            label : {
                    text: 'Sequence coverture',
                    position: 'outer-middle',
            },

        },

        x: {
            label: {
                    text: 'Significance -log10(e-value)',
                    position: 'outer-center',
            },
            tick: {
                    culling: true,
                    fit: false,
                    multiline: false,
            }
        },
    },

});

    var cov_profile_clusters = new Array();
--profile_clusters_array_cov--

    var cov_pics = new Array();
--pics_cov--

    var cov_pics_rc = new Array();
--pics_rc_cov--

    var cov_pics_profile = new Array();
--profile_pics_cov--

    var cov_IDs = new Array();
--IDs_cov--

    var cov_significances = new Array();
--significances_cov--

    var cov_TF_coverture = new Array();
--TF_covertures_cov--

function show_all_cover() {
    coverchart.show([--all_cover--]);
}

function hide_all_cover() {
    coverchart.hide([--all_cover--]);
}

// Show each cluster separately
--function_profile_clusters_points--

function tooltip_contents_2(d, defaultTitleFormat, defaultValueFormat, color) {
    var $$ = this, config = $$.config, CLASS = $$.CLASS,
        titleFormat = config.tooltip_format_title || defaultTitleFormat,
        nameFormat = config.tooltip_format_name || function (name) { return name; },
        valueFormat = config.tooltip_format_value || defaultValueFormat,
        text, i, title_name, title_ID, title_c, title_s,  title_pc, value, name, bgcolor;

    // You can access all of data like this:
    console.log($$.data.targets);
    
    for (i = 0; i < d.length; i++) {
        if (! (d[i] && (d[i].value || d[i].value === 0))) { continue; }
        
        if (! text) {
            title_name = 'Motif Name';
	    title_ID = 'Motif ID';
            title_c = 'Fraction of seq';
            title_s = 'Sig';
            title_pc = 'Profile cluster';
            title_logo = 'Logo';
            title_logo_rc = 'Logo RC';
            title_profile = 'Profile';
            text = "<table class='" + CLASS.tooltip + "'>" + "<tr><th colspan='1'>" + title_name + "</th><th colspan='1'>" + title_ID + "</th><th colspan='1'>" + title_c + "</th><th colspan='1'>" + title_s + "</th><th colspan='1'>" + title_pc + "</th><th colspan='1'>" + title_logo + "</th><th colspan='1'>" + title_logo_rc + "</th><th colspan='1'>" + title_profile + "</th></tr>";
        }

        name = nameFormat(d[i].name);
        value = valueFormat(d[i].value, d[i].ratio, d[i].id, d[i].index);
        bgcolor = $$.levelColor ? $$.levelColor(d[i].value) : color(d[i].id);

        text += "<tr class='" + CLASS.tooltipName + "-" + d[i].id + "'>";
        text += "<td class='name'><span style='background-color:" + bgcolor + "'></span>" + name + "</td>";
        text += "<td>" + cov_IDs[d[i].id] + "</td>";
        text += "<td>" + cov_TF_coverture[d[i].id] + "</td>";
        text += "<td>" + cov_significances[d[i].id] + "</td>";
        text += "<td>" + cov_profile_clusters[d[i].id] + "</td>";
        text += "<td><img class='small_logo' src='" + cov_pics[d[i].id] + "' /></td>";
        text += "<td><img class='small_logo' src='" + cov_pics_rc[d[i].id] + "' /></td>";
        text += "<td><img class='small_pic' src='" + cov_pics_profile[d[i].id] + "' /></td>";
        text += "</tr>";
    }
    return text + "</table>";   
}

</script>

<script charset="utf-8" type="text/javascript">
$(document).ready( function () {
    $('#Motif_tab').DataTable({
        "info":     true,
        "iDisplayLength": 50,
        "order": [[ 3, "asc" ]],
	"search": {
	    "regex": true,
	    "smart": true
	},
	"aoColumnDefs": [
            { "bSortable": true, "aTargets": [ 0,1,2,3,4,5,6,7,8],
 //             "width": "20%",
            }
	]	
    });
});


// Slide the Individual Motif Table
$(document).ready(function() {
    $('#individual_motif_button').click(function() {
	$('#individual_motif_tab').slideToggle('fast');
        $(this).toggleClass('selected_header_section');
    }); 
});


// Slide the Individual Motif Table
$(document).ready(function() {
    $('#dynamic_profile_button').click(function() {
	$('#dynamic_profile').slideToggle('fast');
        $(this).toggleClass('selected_header_section');
    }); 
});


// Slide the Summary Table
$(document).ready(function() {
    $('#summary_table_button').click(function() {
	$('#summary_table').slideToggle('fast');
        $(this).toggleClass('selected_header_section');
    }); 
});


// Slide the Heatmap
$(document).ready(function() {
    $('#sig_coverture_button').click(function() {
	$('#sig_coverture').slideToggle('fast');
        $(this).toggleClass('selected_header_section');
    }); 
});


// Slide the Heatmap
$(document).ready(function() {
    $('#heatmap_button').click(function() {
	$('#heatmap').slideToggle('fast');
        $(this).toggleClass('selected_header_section');
    }); 
});

// Slide the Co-ocurrence Heatmap
$(document).ready(function() {
    $('#heatmap_coocurrence_button').click(function() {
	$('#heatmap_coocurrence').slideToggle('fast');
        $(this).toggleClass('selected_header_section');
    }); 
});


// Slide the additonal files
$(document).ready(function() {
    $('#additional_files_button').click(function() {
	$('#additional_files').slideToggle('fast');
        $(this).toggleClass('selected_header_section');
    }); 
});


</script>



<script type="text/javascript">

    var pics_m1 = new Array();
--pics_m1--

    var profiles_m1 = new Array();
--profiles_m1--

var margin = { top: --left--, right: 500, bottom: --left--, left: --left-- },
  cellSize= --cell_size--;
  col_number= --r_numb--;
  row_number= --c_numb--;
  width = cellSize*col_number, // - margin.left - margin.right,
  height = cellSize*row_number , // - margin.top - margin.bottom,
  //gridSize = Math.floor(width / 24),
  legendElementWidth = cellSize*1,
  colorBuckets = 21,

colors = --gradient--

  // Order of the clusters
  hcrow = [--default_r_number--],
  hcrow_average = [--average_r_number--],
  hcrow_complete = [--complete_r_number--],
  hcrow_single = [--single_r_number--],
  hcrow_ward = [--ward_r_number--],

 // Order of the collections
  hccol = [--default_c_number--],
  hccol_average = [--average_c_number--],
  hccol_complete = [--complete_c_number--],
  hccol_single = [--single_c_number--],
  hccol_ward = [--ward_c_number--],

  rowLabel = [--row_label--],

  colLabel = [--col_label--]; // Rownames -> Motif DataBases

d3.tsv("--file--",
function(d) {
  return {
    row:   +d.Col, 
    col:   +d.Row, 
    value: +d.Value
  };
},
function(error, data) {
  var colorScale = d3.scale.threshold()
      .domain([--domain--])
      .range(colors);

  var svg = d3.select("#d3_heatmap_coocurrence").append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
      ;
  var rowSortOrder=false;
  var colSortOrder=false;
  var rowLabels = svg.append("g")
      .selectAll(".rowLabelg")
      .data(rowLabel)
      .enter()
      .append("text")
      .text(function (d) { return d; })
      .attr("x", 0)
      .attr("y", function (d, i) { return hcrow.indexOf(i+1) * cellSize; })
      .style("text-anchor", "end")
      .attr("transform", "translate(-6," + cellSize / 1.5 + ")")
      .attr("class", function (d,i) { return "rowLabel mono r"+i;} )
      .on("mouseover", function(d) {d3.select(this).classed("text-hover",true);})
      .on("mouseout" , function(d) {d3.select(this).classed("text-hover",false);})
      .on("click", function(d,i) {rowSortOrder=!rowSortOrder; sortbylabel("r",i,rowSortOrder);d3.select("#order").property("selectedIndex", 4).node().focus();;})
      ;

  var colLabels = svg.append("g")
      .selectAll(".colLabelg")
      .data(colLabel)
      .enter()
      .append("text")
      .text(function (d) { return d; })
      .attr("x", 0)
      .attr("y", function (d, i) { return hccol.indexOf(i+1) * cellSize; })
      .style("text-anchor", "left")
      .attr("transform", "translate("+cellSize/2 + ",-6) rotate (-90)")
      .attr("class",  function (d,i) { return "colLabel mono c"+i;} )
      .on("mouseover", function(d) {d3.select(this).classed("text-hover",true);})
      .on("mouseout" , function(d) {d3.select(this).classed("text-hover",false);})
      .on("click", function(d,i) {colSortOrder=!colSortOrder;  sortbylabel("c",i,colSortOrder);d3.select("#order").property("selectedIndex", 4).node().focus();;})
      ;

  var heatMap = svg.append("g").attr("class","g3")
        .selectAll(".cellg")
        .data(data,function(d){return d.row+":"+d.col;})
        .enter()
        .append("rect")
        .attr("x", function(d) { return hccol.indexOf(d.col) * cellSize; })
        .attr("y", function(d) { return hcrow.indexOf(d.row) * cellSize; })
        .attr("class", function(d){return "cell cell-border cr"+(d.row-1)+" cc"+(d.col-1);})
        .attr("width", cellSize)
        .attr("height", cellSize)
        .style("fill", function(d) { return colorScale(d.value); })
        /* .on("click", function(d) {
               var rowtext=d3.select(".r"+(d.row-1));
               if(rowtext.classed("text-selected")==false){
                   rowtext.classed("text-selected",true);
               }else{
                   rowtext.classed("text-selected",false);
               }
        })*/
        .on("mouseover", function(d){
               //highlight text
               d3.select(this).classed("cell-hover",true);
               d3.selectAll(".rowLabel").classed("text-highlight",function(r,ri){ return ri==(d.row-1);});
               d3.selectAll(".colLabel").classed("text-highlight",function(c,ci){ return ci==(d.col-1);});

               //Update the tooltip position and value
               d3.select("#tooltip")
                 .style("left", (d3.event.pageX+5) + "px")
                 .style("top", (d3.event.pageY-450) + "px")
                 .select("#value")
                 .html("<table><thead><tr class='tooltip_tab'><th colspan='1'>Motif A</th><th colspan='1'>Motif A Logo</th><th colspan='1'>Motif A Profile</th><th>Co-occurrence (%)</th><th>Motif B</th><th>Motif B Logo</th><th>Motif B Profile</th></tr></thead><tbody><tr class='tooltip_cell'><td>" + colLabel[d.col-1] + "</td><td><img class='small_logo_tooltip' src='" + pics_m1[TF_names[colLabel[d.col-1]]] + "'></td><td><img class='small_profile_tooltip' src='" + profiles_m1[TF_names[colLabel[d.col-1]]] + "'></td><td>" + d.value + "</td><td>" + rowLabel[d.row-1] + "</td><td><img class='small_logo_tooltip' src='" + pics_m1[TF_names[rowLabel[d.row-1]]] + "'></td><td><img class ='small_profile_tooltip' src='" + profiles_m1[TF_names[rowLabel[d.row-1]]] + "'></td></tr></tbody></table>")
               ;
               //Show the tooltip
               d3.select("#tooltip").classed("hidden", false);
        })
        .on("mouseout", function(){
               d3.select(this).classed("cell-hover",false);
               d3.selectAll(".rowLabel").classed("text-highlight",false);
               d3.selectAll(".colLabel").classed("text-highlight",false);
               d3.select("#tooltip").classed("hidden", true);
        })
        ;

  var legend = svg.selectAll(".legend")
      .data([--data_legend--])
      .enter().append("g")
      .attr("class", "legend");

  legend.append("rect")
    .attr("x", width + (cellSize*1) + 30)
    .attr("y", function(d, i) { return legendElementWidth * i - cellSize; })
    .attr("width", cellSize)
    .attr("height", legendElementWidth)
    .style("fill", function(d, i) { return colors[i]; });

  legend.append("text")
    .attr("class", "mono")
    .text(function(d) { return d; })
    .attr("width", legendElementWidth)
    .attr("x", width + (cellSize*4))
    .attr("y", function(d, i) { return legendElementWidth * i; })

  legend.append("text")
    .attr({
	'font-size': 12,
	'x': width + (cellSize*1) + 30,
	'y': -15
    })
    .text("Percentage");


// Change ordering of cells

  function sortbylabel(rORc,i,sortOrder){
       var t = svg.transition().duration(1500);
       var log2r=[];
       var sorted; // sorted is zero-based index
       d3.selectAll(".c"+rORc+i)
         .filter(function(ce){
            log2r.push(ce.value);
          })
       ;
       if(rORc=="r"){ // sort log2ratio of a gene
         sorted=d3.range(col_number).sort(function(a,b){ if(sortOrder){ return log2r[b]-log2r[a];}else{ return log2r[a]-log2r[b];}});
         t.selectAll(".cell")
           .attr("x", function(d) { return sorted.indexOf(d.col-1) * cellSize; })
           ;
         t.selectAll(".colLabel")
          .attr("y", function (d, i) { return sorted.indexOf(i) * cellSize; })
         ;
       }else{ // sort log2ratio of a contrast
         sorted=d3.range(row_number).sort(function(a,b){if(sortOrder){ return log2r[b]-log2r[a];}else{ return log2r[a]-log2r[b];}});
         t.selectAll(".cell")
           .attr("y", function(d) { return sorted.indexOf(d.row-1) * cellSize; })
           ;
         t.selectAll(".rowLabel")
          .attr("y", function (d, i) { return sorted.indexOf(i) * cellSize; })
         ;
       }
  }

  d3.select("#order").on("change",function(){
    order(this.value);
  });

  function order(value){

  if(value=="default"){

    var t = svg.transition().duration(1500);
    t.selectAll(".cell")
      .attr("x", function(d) { return hccol.indexOf(d.col) * cellSize; })
      .attr("y", function(d) { return hcrow.indexOf(d.row) * cellSize; })
      ;

    t.selectAll(".rowLabel")
      .attr("y", function (d, i) { return hcrow.indexOf(i+1) * cellSize; })
      ;

    t.selectAll(".colLabel")
      .attr("y", function (d, i) { return hccol.indexOf(i+1) * cellSize; })
      ;

   // Complete Linkage
   } else if(value=="single"){

    var t = svg.transition().duration(1500);
    t.selectAll(".cell")
      .attr("x", function(d) { return hccol_single.indexOf(d.col) * cellSize; })
      .attr("y", function(d) { return hcrow_single.indexOf(d.row) * cellSize; })
      ;

    t.selectAll(".rowLabel")
      .attr("y", function (d, i) { return hcrow_single.indexOf(i+1) * cellSize; })
      ;

    t.selectAll(".colLabel")
      .attr("y", function (d, i) { return hccol_single.indexOf(i+1) * cellSize; })
      ;

   // Complete Linkage
   } else if(value=="complete"){

    var t = svg.transition().duration(1500);
    t.selectAll(".cell")
      .attr("x", function(d) { return hccol_complete.indexOf(d.col) * cellSize; })
      .attr("y", function(d) { return hcrow_complete.indexOf(d.row) * cellSize; })
      ;

    t.selectAll(".rowLabel")
      .attr("y", function (d, i) { return hcrow_complete.indexOf(i+1) * cellSize; })
      ;

    t.selectAll(".colLabel")
      .attr("y", function (d, i) { return hccol_complete.indexOf(i+1) * cellSize; })
      ;

   // Ward Linkage
   } else if(value=="ward"){

    var t = svg.transition().duration(1500);
    t.selectAll(".cell")
      .attr("x", function(d) { return hccol_ward.indexOf(d.col) * cellSize; })
      .attr("y", function(d) { return hcrow_ward.indexOf(d.row) * cellSize; })
      ;

    t.selectAll(".rowLabel")
      .attr("y", function (d, i) { return hcrow_ward.indexOf(i+1) * cellSize; })
      ;

    t.selectAll(".colLabel")
      .attr("y", function (d, i) { return hccol_ward.indexOf(i+1) * cellSize; })
      ;

   // Average Linkage
   } else if(value=="average"){

    var t = svg.transition().duration(1500);
    t.selectAll(".cell")
      .attr("x", function(d) { return hccol.indexOf(d.col) * cellSize; })
      .attr("y", function(d) { return hcrow_average.indexOf(d.row) * cellSize; })
      ;

    t.selectAll(".rowLabel")
      .attr("y", function (d, i) { return hcrow_average.indexOf(i+1) * cellSize; })
      ;

    t.selectAll(".colLabel")
      .attr("y", function (d, i) { return hccol_average.indexOf(i+1) * cellSize; })
      ;
   }
  }
  //
  var sa=d3.select(".g3")
      .on("mousedown", function() {
          if( !d3.event.altKey) {
             d3.selectAll(".cell-selected").classed("cell-selected",false);
             d3.selectAll(".rowLabel").classed("text-selected",false);
             d3.selectAll(".colLabel").classed("text-selected",false);
          }
         var p = d3.mouse(this);
         sa.append("rect")
         .attr({
             rx      : 0,
             ry      : 0,
             class   : "selection",
             x       : p[0],
             y       : p[1],
             width   : 1,
             height  : 1
         })
      })
      .on("mousemove", function() {
         var s = sa.select("rect.selection");

         if(!s.empty()) {
             var p = d3.mouse(this),
                 d = {
                     x       : parseInt(s.attr("x"), 10),
                     y       : parseInt(s.attr("y"), 10),
                     width   : parseInt(s.attr("width"), 10),
                     height  : parseInt(s.attr("height"), 10)
                 },
                 move = {
                     x : p[0] - d.x,
                     y : p[1] - d.y
                 }
             ;

             if(move.x < 1 || (move.x*2<d.width)) {
                 d.x = p[0];
                 d.width -= move.x;
             } else {
                 d.width = move.x;
             }

             if(move.y < 1 || (move.y*2<d.height)) {
                 d.y = p[1];
                 d.height -= move.y;
             } else {
                 d.height = move.y;
             }
             s.attr(d);

                 // deselect all temporary selected state objects
             d3.selectAll('.cell-selection.cell-selected').classed("cell-selected", false);
             d3.selectAll(".text-selection.text-selected").classed("text-selected",false);

             d3.selectAll('.cell').filter(function(cell_d, i) {
                 if(
                     !d3.select(this).classed("cell-selected") &&
                         // inner circle inside selection frame
                     (this.x.baseVal.value)+cellSize >= d.x && (this.x.baseVal.value)<=d.x+d.width &&
                     (this.y.baseVal.value)+cellSize >= d.y && (this.y.baseVal.value)<=d.y+d.height
                 ) {

                     d3.select(this)
                     .classed("cell-selection", true)
                     .classed("cell-selected", true);

                     d3.select(".r"+(cell_d.row-1))
                     .classed("text-selection",true)
                     .classed("text-selected",true);

                     d3.select(".c"+(cell_d.col-1))
                     .classed("text-selection",true)
                     .classed("text-selected",true);
                 }
             });
         }
      })
      .on("mouseup", function() {
            // remove selection frame
         sa.selectAll("rect.selection").remove();

             // remove temporary selection marker class
         d3.selectAll('.cell-selection').classed("cell-selection", false);
         d3.selectAll(".text-selection").classed("text-selection",false);
      })
      .on("mouseout", function() {
         if(d3.event.relatedTarget.tagName=='html') {
                 // remove selection frame
             sa.selectAll("rect.selection").remove();
                 // remove temporary selection marker class
             d3.selectAll('.cell-selection').classed("cell-selection", false);
             d3.selectAll(".rowLabel").classed("text-selected",false);
             d3.selectAll(".colLabel").classed("text-selected",false);
         }
      })
      ;
});

</script>