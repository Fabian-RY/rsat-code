
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%% DRAWING GRAPHS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Drawing graphs}


\subsection{feature-map}

The program \program{feature-map} draws a graphical map of a list of
features. A typical usage of feature-map is to draw maps with the
positions of regulatory motifs detected by pattern matching programs
such \program{dna-pattern} (string-based matching) or \program{patser}
(matrix-based matching).

\subsubsection{Converting pattern matches into features}

We will analyze the same PHO family as in the tutorial on pattern
discovery. We will use successively \program{oligo-analysis},
\program{dna-pattern} and \program{features-from-dnapat} to obtain a
list of features with the matching locations of the over-represented
hexanucleotides.

\begin{enumerate}

\item Run \program{oligo-analysis} to detect over-represented 
hexanucleotides in the upstream sequences of the PHO
genes.

\begin{verbatim} 
oligo-analysis -i PHO_up800.fasta -format fasta      \
    -v -l 6 -2str                                    \
    -return occ,proba -thosig 0 -bg upstream         \
    -org Saccharomyces_cerevisiae -sort              \
    -o PHO_up800_6nt_2str_ncf_sig0 
\end{verbatim}

\item Run \program{dna-pattern} to locate these patterns in 
the upstream sequences.

\begin{verbatim} 
dna-pattern -i PHO_up800.fasta -format fasta    \
    -pl PHO_up800_6nt_2str_ncf_sig0             \
    -o  PHO_up800_6nt_2str_ncf_sig0_matches.tab
\end{verbatim}

\item Run \program{features-from-dnapat} to convert these pattern 
matches into features.

\begin{verbatim}
features-from-dnapat                           \
    -i PHO_up800_6nt_2str_ncf_sig0_matches.tab \
    -o PHO_up800_6nt_2str_ncf_sig0_matches.ft 
\end{verbatim}

\end{enumerate}

We will now play with this feature file, in order to obtain different
drawings.

\subsubsection{Basic feature maps}

\begin{verbatim}
feature-map -format jpg                            \
    -i PHO_up800_6nt_2str_ncf_sig0_matches.ft  \
    -o PHO_up800_6nt_2str_ncf_sig0_matches.jpg
\end{verbatim}

You can now open the file
\file{PHO\_up800\_6nt\_2str\_ncf\_sig0\_matches.jpg} with a web
browser or a drawing application.

This is a very simple representation: each feature is represented as a
box. A specific color is associated to each pattern (feature ID). 

\subsubsection{Refining the feature map}

We will use a few additional options to add information on this
feature map. 

\begin{verbatim}
feature-map -format jpg                        \
    -i PHO_up800_6nt_2str_ncf_sig0_matches.ft  \
    -o PHO_up800_6nt_2str_ncf_sig0_matches.jpg \
    -legend -scalebar -scalestep 50            \
    -from 0 -to 800 -origin 801                \
    -scorethick  \
    -title 'Over-represented 6nt in PHO upstream sequences' 
\end{verbatim}

This example illustrates some capabilities of \program{feature-map}:

\begin{itemize}
\item A title has been added to the drawing. 

\item A specific height is associated to each box, to reflect
the score associated to the corresponding feature.

\item The scale bar indicates the location, in base pairs. 

\item A legend indicates the color associated to each pattern, as well 
as its score. 

\end{itemize}

\subsubsection{Map orientation}

Feature-maps can be oriented horizontally or vertically. The
horizontal orientation is usually the most convenient, but when labels
are attached to each feature, the vertical orientation prevents them
from expanding over each other.

\begin{verbatim}
feature-map -format jpg                        \
    -i PHO_up800_6nt_2str_ncf_sig0_matches.ft  \
    -o PHO_up800_6nt_2str_ncf_sig0_matches.jpg \
    -legend -scalebar -scalestep 50            \
    -from 0 -to 800 -origin 801                \
    -vertical -symbol -label pos               \
    -title 'Over-represented 6nt in PHO upstream sequences' 
\end{verbatim}

In this representation, a \concept{label} is written besides each
feature box. In addition, a \concept{symbol} has been attached to each
feature ID (pattern). This symbol improves the readability of the map, 
and is convenient for monochrome printers. 

\subsubsection{Export formats}

Feature-map can be exported in different formats, specified with the
option \option{-format}.

\begin{description}

\item[jpg] (default) The \concept{jpg} format (also called \concept{jpeg})
is a bitmap format recognized by all the web browsers and most drawing
applications. The jpg standard includes a compression protocol, so
that the resulting images occupy a reasonable space on the hard disk.

\item[png] The \concept{png} format is a bitmap format which gives a 
better color rendering than jpg. It is not compressed, and requires
more space for storage. It is recognized by most browsers.

\item[ps] The \concept{postscript} (\concept{ps}) format is a vectorial format, which
ensures a high quality result on printing devices. Postscript files
can be opened with specific applications, depending on the operating
system (ghostview, ghostscript). This format is recommended for
drawing graphs to be included in publications.

\end{description}

\subsubsection{HTML maps}

A HTML map can be created, which allows to display dynamically the
feature-map in a web browser. When the users positions the mouse over
a feature, the corresponding information is displayed in the status
bar.

\begin{verbatim}
feature-map -format jpg                        \
    -i PHO_up800_6nt_2str_ncf_sig0_matches.ft  \
    -o PHO_up800_6nt_2str_ncf_sig0_matches.jpg \
    -legend -scalebar -scalestep 50            \
    -from 0 -to 800 -origin 801                \
    -scorethick  -dots                         \
    -title 'Over-represented 6nt in PHO upstream sequences' \
    -htmap > PHO_up800_6nt_2str_ncf_sig0_matches.html
\end{verbatim}

Notice that we used the option \option{-dot} to attach a colored filled 
circle to each feature box. 

Open the file \file{PHO\_up800\_6nt\_2str\_ncf\_sig0\_matches.html}
with a web browser (e.g. Netscape, Mozilla, Safari). Position the
mouse cursor over a feature (either the box or the filled circle
attached to it), and look the status bar at the bottom of the browser
window.

\subsubsection{Other options}

The program \program{feature-map} includes a few other options.

\begin{verbatim}
feature-map -help
\end{verbatim}

A complete description of their functionality is provided in 
the help pages.

\begin{verbatim}
feature-map -h
\end{verbatim}

\subsubsection{Feature converters}

In the previous tutorial, we used the program
\program{features-from-dnapat} to convert matches from
\program{dna-pattern} to features. 

\RSAT includes a few additional converters.

\begin{description}

\item[features-from-dnapat] \program{dna-pattern} is the string-based 
matching program included in the  \RSAT distribution. 

\item[features-from-dssp] extract features from the output file of
\program{dssp} (secondary structures)

\item[features-from-fugue] extract features from the output file of
\program{fugue}

\item[features-from-gibbs] extracts features from the \program{gibbs} 
motif sampler, developed by Andrew Neuwald. 

\item[features-from-matins] extracts features from the result of 
\program{matinspector}, developed in Thomas Werner's team. 

\item[features-from-msf] converts a multiple alignment file from 
format \file{msf} for features. 

\item[features-from-patser] extact features from the result of the 
matrix-based pattern matching \program{patser}, developed by Jerry Hertz. 

\item[features-from-sigscan] extract features from the results of the
\program{sigscan} program. 

\item[features-from-swissprot] extract features from a \program{Swissprot} file. 

\end{description}


If you need to draw features from any other type of program 
output, it is quite simple to write your own converter. The feature-map 
input is a tab-delimited text file, with one row per feature, and 
one column per attribute. 

\begin{enumerate}
\item map label (eg gene name)
\item feature type
\item feature identifier (ex: GATAbox, Abf1\_site)
\item strand (D for Direct, R for Reverse),
\item feature start position
\item feature end position
\item (optional) description 
\item (optional) score
\end{enumerate}

\subsection{XYgraph}

The program \program{XYgraph} is a simple utility which plots graphs
from a series of (x,y) coordinates.
