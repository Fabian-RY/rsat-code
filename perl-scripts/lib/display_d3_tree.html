<!DOCTYPE html>
<meta charset="utf-8">

<head>

	<script type="text/javascript" src=""></script>
    <meta charset=utf-8 />
    <title> matrix-clustering matrices' tree </title>
    <link rel="stylesheet" type="text/css" href="stylesheet.css"/>
</head>


<style>

	.node circle {
		fill: #fff;
		stroke: steelblue;
		stroke-width: 2px;
	}


	.node {
		font: 10px sans-serif;
	}


	.link {
		fill: none;
		stroke: #0D86D7;
		stroke-width: 1.5px;
	}
	
	svg {
		pointer-events: all;
		background-color: #EEEEEE;
		overflow: scroll;
	}
	
</style>


<body>
	
	<div id="chart"></div>
	<script type="text/javascript">

	var width = 2200,
		height =,
		m = [40, 240, 40, 240],
		w = width ,//-m[0] -m[0],
		h = height //-m[0] -m[2];
	;


	var cluster = d3.layout.cluster()
		.size([height, width - 1200])
	        .separation(function(a, b) { return (a.parent == b.parent ? 0.3 : 0.3); });


	var svg = d3.select("body").append("svg")
		.attr("width", width)
		.attr("height", height)
		.append("g")
		.attr("class","drawarea")
		.attr("transform", "translate(40,0)");
		

	d3.json(, function(json) {
				
	var nodes = cluster.nodes(json);

	var link = svg.selectAll("path.link")
		.data(cluster.links(nodes))
		.enter().append("path")
		.attr("class", "link")
		.attr("d", elbow);


	var node = svg.selectAll("g.node")
		.data(nodes)
		.enter().append("g")
		.attr("class", "node")
		.attr("transform", function(d) { return "translate(" + d.y + "," + d.x + ")"; });

	
	node.append("circle")
		.attr("r", 6.5);
	

	node.append("a")
		.attr("xlink:href", function(d) { return d.url; })
		.append("text")
		.text(function(d) { return d.children ? "" : d.name; })
		.attr("dx", function(d) { return d.children ? -20 : 20; })
		.attr("dy", function(d) { return d.children ? -6 : 3; })
		.attr("text-anchor", function(d) { return d.children ? "end" : "start"; });
	
	// Add the consensus
	node.append("text")
		.text(function(d){ return d.children ? d.name : d.consensus; })
		.attr("x", function(d){ return d.children ? -23 : 20; })
		.attr("dy", function(d){ return d.children ? -6 : 25; })
		.attr("text-anchor", function(d){ return d.children ? "end" : "start"; })
	;
		
	node.append("svg:image")
		.attr("xlink:href", function(d) { return d.image; })  
		.attr("width", function(d) { return (d.size + 2)  * 27; })
		.attr("height", 120)
		.attr("x", 250)    
		.attr("y", -50) 
		.attr("preserveAspectRatio", "none");

	d3.select("svg")
        .call(d3.behavior.zoom()
        .scaleExtent([0.5, 5])
        .on("zoom", zoom));
			
	});
	

	
/////////////////
/// Functions ///
/////////////////	
	
        
	function zoom() {
	
		var scale = d3.event.scale,
			translation = d3.event.translate,
			tbound = -h * scale,
			bbound = h * scale,
			lbound = (-w /*+ m[1]*/) * scale,
			rbound = (w /*- m[3]*/) * scale;

		// limit translation to thresholds
			translation = [
				Math.max(Math.min(translation[0], rbound), lbound),
				Math.max(Math.min(translation[1], bbound), tbound)
			];
    
		d3.select(".drawarea")
			.attr("transform", "translate(" + translation + ")" +
              " scale(" + scale + ")");
		}


	function elbow(d, i) {
		
		return "M" + d.source.y + "," + d.source.x
		+ "V" + d.target.x + "H" + d.target.y;
	}

</script>
